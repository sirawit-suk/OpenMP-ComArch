/*
This is CountingSort algorithm use OpenMP (For running in parallel for optimization)

Original reference (Nickson Joram):
https://medium.com/geekculture/implementation-and-performance-analysis-of-parallel-and-serial-counting-sort-algorithm-using-openmp-56016f9ccb5c

Others:
https://stackoverflow.com/questions/39903181/can-you-do-a-parallel-counting-sort-in-on-p-time
*/

#include <stdio.h>
#include <stdlib.h>
#include <omp.h>
#include <string.h>
#include <time.h>

#define max_num 200000
int n;
int a[max_num], sorted[max_num];

void generate() {
    srand(1);
    int i;
    for (i = 0; i < n; i++) {
        a[i] = rand() % 1000 + 1;
        sorted[i] = 0;
    }
}

void parallel() {
    int i, j, count;

    double start_time = omp_get_wtime();
    #pragma omp parallel private(i, j, count)
    {
        #pragma omp for
        for (i = 0; i < n; i++) {
            count = 0;
            for (j = 0; j < n; j++) {
                if (a[i] > a[j])
                    count++;
            }
            while (sorted[count] != 0)
                count++;
            sorted[count] = a[i];
        }
    }
    double end_time = omp_get_wtime();
    double time_used = end_time - start_time;
    printf("Parallel time: %f s\n", time_used);
}

/*
void serial() {
    int i, j, count;
    double start_time = omp_get_wtime();
    for (i = 0; i < n; i++) {
        count = 0;
        for (j = 0; j < n; j++) {
            if (a[i] > a[j]) {
                count++;
            }
        }
        while (sorted[count] != 0)
            count++;
        sorted[count] = a[i];
    }
    double end_time = omp_get_wtime();
    double time_used = end_time - start_time;
    printf("\nSerial time: %f s\n", time_used);
}
*/

int main(int argc, char* argv[]) {
    int i;
    int thread = atoi(argv[1]); // convert string to int
    n = atoi(argv[2]);
    
    omp_set_num_threads(thread);
    
    printf("Avaliable %d Threads now\n",omp_get_max_threads());
    printf("Enter the size of the data to be sorted (max: 200000, 0 to end) : ");
    while (n) {
        if (n > max_num) {
            puts("Data size is too large, re-enter");
            printf("\nEnter the data size to be sorted, enter 0 to end : ");
            continue;
        }
        generate();
        parallel();
        //serial();
        
        //Add this line
        break;
        
        //for (i = 0; i <n; i ++) 
        //printf("%d ", sorted[i]);

    }
    return 0;
}
